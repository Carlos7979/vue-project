import{I as h}from"./Input-10dadd1b.js";import{S as f}from"./sweetalert2.all-4f073957.js";import{_ as m,m as p,a as _,s as g,r as l,o as b,c as I,b as i,d as n,n as v,w as x,p as w,e as S}from"./index-15545614.js";const y={}.VITE_USER_URL,L={name:"Login",components:{Input:h},props:{},data(){return{form:{user:"",password:""},isSubmitted:!1,error:!1}},methods:{...p("user",["login"]),async handleInput([t,r]){this.form[t]=r,this.isSubmitted&&await this.validate()&&(this.error=!1)},handleShowRegister(){this.$refs.form.reset(),this.$router.push({path:"/register"})},validate(t,r){const e=this.$refs.error;if(t)return e.innerText="Debes identificarte como usuario",this.error||(this.error=!0),this.isSubmitted=!0,!1;if(r)return e.innerText="El usuario o contraseña es incorrecto",this.error||(this.error=!0),!1;for(const s in this.form)if(!this.form[s])return e.innerText="Todos los campos son obligatorios",this.error||(this.error=!0),!1;return e.innerText="",!0},handleLogin(t){this.login(t)}},mounted(){this.$route.name==="unauthorized"&&this.validate(!0),this.$refs.form.addEventListener("submit",async r=>{r.preventDefault(),this.isSubmitted=!0;try{let e,s=await _.get(y);if(s=s.data,s.length){if(e=s.find(o=>o.user===this.form.user),!e){this.validate(null,!0);return}if(e.password!==this.form.password){this.validate(null,!0);return}}else{this.validate(null,!0);return}this.validate()&&(delete e.password,f.fire({icon:"success",title:"Ingreso exitoso",showConfirmButton:!1,timer:1500}).then(()=>{r.target.reset();for(const o in this.form)this.form[o]="";this.isSubmitted=!1,g("user",e),this.handleLogin(e),this.$router.push({path:`/${e.admin?"admin":"listing"}`})}))}catch(e){console.log(e),e.message&&(error.innerText=`Falla del servidor:
${e.message}`,this.error||(this.error=!0))}})}},d=t=>(w("data-v-5094bcb6"),t=t(),S(),t),R={class:"register"},$={ref:"form",action:"",method:"post"},k=d(()=>i("button",{class:"btn form-control text-bg-dark p-3"},"INGRESAR",-1)),T=d(()=>i("button",{class:"btn form-control text-bg-primary mt-2"},"Regístrate",-1));function E(t,r,e,s,o,a){const u=l("Input"),c=l("RouterLink");return b(),I("div",R,[i("form",$,[n(u,{type:"text",id:"user",placeholder:"user1",onInput:a.handleInput},null,8,["onInput"]),n(u,{type:"password",id:"password",placeholder:"test123",onInput:a.handleInput},null,8,["onInput"]),k,i("div",{ref:"error",class:v(o.error?"error":"")},null,2)],512),n(c,{to:"/register"},{default:x(()=>[T]),_:1})])}const U=m(L,[["render",E],["__scopeId","data-v-5094bcb6"]]);export{U as default};
